#!/bin/bash
# Cart Testing Automation Script
# This script helps automate the testing checklist

echo "üß™ Baby Cotton Club - Cart Testing Script"
echo "=========================================="
echo ""

# Check if server is running
if lsof -Pi :3000 -sTCP:LISTEN -t >/dev/null ; then
    echo "‚úÖ Development server is running on http://localhost:3000"
else
    echo "‚ùå Development server is NOT running"
    echo "Starting server..."
    npm start &
    sleep 10
    echo "‚úÖ Server started"
fi

echo ""
echo "üìã Manual Testing Checklist:"
echo ""
echo "1. Open http://localhost:3000 in your browser"
echo "2. Press F12 to open Developer Tools"
echo "3. Go to Console tab"
echo ""
echo "Expected console message:"
echo "   üîç Cart Debug Tools Loaded!"
echo ""
echo "Available debug commands:"
echo "   - inspectCart()      ‚Üí View cart state"
echo "   - testCartUpdate()   ‚Üí Test API call"
echo "   - fixCartTypes()     ‚Üí Fix type issues"
echo "   - clearCartDebug()   ‚Üí Clear cart"
echo ""
echo "üìù Testing Sequence:"
echo ""
echo "Step 1: Login"
echo "   ‚ñ° Click 'Login' in navigation"
echo "   ‚ñ° Enter credentials"
echo "   ‚ñ° Verify login successful"
echo ""
echo "Step 2: Test Product WITHOUT Size"
echo "   ‚ñ° Find product without sizes (e.g., bedding)"
echo "   ‚ñ° Click 'Add to Cart'"
echo "   ‚ñ° Check console for success message"
echo "   ‚ñ° Verify cart icon updates"
echo ""
echo "Step 3: Test Product WITH Size"
echo "   ‚ñ° Find product with sizes (e.g., clothing)"
echo "   ‚ñ° Try adding WITHOUT selecting size (should fail)"
echo "   ‚ñ° Select a size (S, M, L, XL)"
echo "   ‚ñ° Click 'Add to Cart'"
echo "   ‚ñ° Check console - size should be in payload"
echo "   ‚ñ° Verify cart icon updates"
echo ""
echo "Step 4: Inspect Cart"
echo "   ‚ñ° In console, type: inspectCart()"
echo "   ‚ñ° Verify all green checkmarks ‚úÖ"
echo "   ‚ñ° Check no red errors ‚ùå"
echo ""
echo "Step 5: View Cart Page"
echo "   ‚ñ° Click cart icon"
echo "   ‚ñ° Verify all items shown with correct details"
echo "   ‚ñ° Verify sizes are displayed"
echo ""
echo "Step 6: Update Quantities"
echo "   ‚ñ° Click + button (increase)"
echo "   ‚ñ° Check console for update success"
echo "   ‚ñ° Click - button (decrease)"
echo "   ‚ñ° Click Remove"
echo ""
echo "Step 7: Test Checkout"
echo "   ‚ñ° Add multiple items"
echo "   ‚ñ° Click 'Proceed to Checkout'"
echo "   ‚ñ° Check console for 3 cart updates"
echo "   ‚ñ° Verify no 400 errors"
echo ""
echo "Step 8: Verify API Calls"
echo "   ‚ñ° In console, type: testCartUpdate()"
echo "   ‚ñ° Check for success response"
echo "   ‚ñ° If 400 error, run: inspectCart()"
echo ""
echo "üîß If Issues Found:"
echo ""
echo "Run in console:"
echo "   fixCartTypes()    ‚Üí Fix type mismatches"
echo "   clearCartDebug()  ‚Üí Start fresh"
echo "   inspectCart()     ‚Üí Diagnose issues"
echo ""
echo "Check documentation:"
echo "   - CART_TESTING_GUIDE.md"
echo "   - DEBUGGING_400_ERROR.md"
echo "   - CART_DEBUG_TOOLS.md"
echo ""
echo "‚úÖ Server is ready for testing!"
echo "Open http://localhost:3000 and follow the checklist above"
echo ""
